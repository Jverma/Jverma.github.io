<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Bloom Filters &#8211; Random Inferences</title>
<meta name="description" content="Quick introduction to bloom filter data structure.">
<meta name="keywords" content="mathematics, computer science, data structures">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Bloom Filters">
<meta name="twitter:description" content="Quick introduction to bloom filter data structure.">
<meta name="twitter:site" content="@januverma">
<meta name="twitter:creator" content="@januverma">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://jverma.github.io//images/sample-image-4.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Bloom Filters">
<meta property="og:description" content="Quick introduction to bloom filter data structure.">
<meta property="og:url" content="http://jverma.github.io//bloom-filter/">
<meta property="og:site_name" content="Random Inferences">

<meta property="og:image" content="http://jverma.github.io//images/sample-image-4.jpg">






<link rel="canonical" href="http://jverma.github.io//bloom-filter/">
<link href="http://jverma.github.io//feed.xml" type="application/atom+xml" rel="alternate" title="Random Inferences Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://jverma.github.io//assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://jverma.github.io//assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://jverma.github.io//assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://jverma.github.io//assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://jverma.github.io//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://jverma.github.io//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://jverma.github.io//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://jverma.github.io//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://jverma.github.io//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jverma.github.io//images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://jverma.github.io//">Random Inferences</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="http://jverma.github.io//about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//posts/" >Blog</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//research/" >Research</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//Code/" >Code</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


  <div class="image-wrap">
  <img src=
    
      "http://jverma.github.io//images/sample-image-4.jpg"
    
  alt="Bloom Filters feature image">
  
    <span class="image-credit">Photo Credit: <a href="http://wegraphics.net/downloads/free-ultimate-blurred-background-pack/">WeGraphics</a></span>
  
  </div><!-- /.image-wrap -->


<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="http://jverma.github.io//images/IMG_20141123_115642.jpg" class="bio-photo" alt="Janu Verma bio photo">


  <h3 itemprop="name">Janu Verma</h3>
  <p>Research Engineer at IBM T.J. Watson Research Center.</p>
  
  <a href="http://twitter.com/januverma" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  <a href="http://facebook.com/janu.verma" class="author-social" target="_blank"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a>
  
  <a href="http://linkedin.com/in/janu-verma-b79b8823" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  <a href="http://instagram.com/jverma" class="author-social" target="_blank"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
  <a href="http://januverma.tumblr.com" class="author-social" target="_blank"><i class="fa fa-fw fa-tumblr-square"></i> Tumblr</a>
  <a href="http://github.com/Jverma" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://jverma.github.io//bloom-filter/" rel="bookmark" title="Bloom Filters">Bloom Filters</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>A <strong>Bloom filter</strong> is a compact data structure which is used to test membership of an element in a set. It is built by constructing a probablistic representation of the set, which can be queried for membership. A BF is designed for speed and effciency. The trade off for this efficiency is that a Bloom filter is probabilistic, in the sense that it tells us that the element is either definitely not in the set or may be in the set. Thus we can have some false positives i.e. the elements which are not in the set but the BF computes postive probability of it being in the set.
<br><br>
A bloom filter supports two operations</p>

<ul>
<li><strong>Add</strong>: adds an element \( x \) to the set \( S \).</li>
<li><strong>Test </strong>: checks whether a given element \( x \) is in the set \( S \) or not. Test returns a boolean value as follows </li>
</ul>

<p>$$ Test = \begin{cases}
        false, \text{then x is definitely not in S} \
        true, \text{then x is probably in the set }
    \end{cases}
$$
<br>
A BF should also compute the <em>false positive rate</em>.</p>

<p><br><br>
<strong>Construction of a Bloom filter:</strong>
<br>
Consider a set \( S = {a_1, a_2, \ldots, a_n} \). Bloom filters describe membership information of \( S \) using a bit array \( V \) of length \( m \). It consists of an array of \( m \) bits, each initialized to \( 0 \). To add an item \( \theta \) to the bloom filter, \( k \) independent hash functions \( H_{1}(\theta), H_{2}(\theta), \ldots, H_{k}(\theta) \) are calculated. Each maps \( \theta \) to an integer in \( [0, m) \) and the corresponding \( h \) array bits are set to 1.
<br><br>
To test if an item \( \alpha \) is a member, the same hash functions are applied to 
\( \alpha \) and the corresponding values in the bitarray are checked. \( \alpha \) is a member if all corresponding bits are set to 1.
<br><br>
By construction, a bloom filter correctly identifies whether a element is added to to it. But there is a false positive rate as well. A false positive occurs if all the bits corresponding to an element \( \gamma \) are set to 1 by coincidence because of the items besides \( \gamma \) that were added previously.</p>

<p><br><br>
<strong>Example: </strong>
<br>
I borrowed the following example from <a href="http://kellabyte.com/2013/01/24/using-a-bloom-filter-to-reduce-expensive-operations-like-disk-io/">kellabyte</a>
<br>
A bloom starts by initializing an empty bitarray : 
<figure>
<a href="https://januverma.files.wordpress.com/2015/06/bloomfilter_empty_thumb1.jpg"><img src="https://januverma.files.wordpress.com/2015/06/bloomfilter_empty_thumb1.jpg?w=300" alt="bloomfilter_empty_thumb1" width="300" height="42" class="alignnone size-medium wp-image-883" /></a>
<fugure>
<br><br>
When a new element is added, the hashes are computed and the corresponding bits are turned on :
<figure><br>
<a href="https://januverma.files.wordpress.com/2015/06/bloomfilter_adding_thumb1.jpg"><img src="https://januverma.files.wordpress.com/2015/06/bloomfilter_adding_thumb1.jpg?w=300" alt="bloomfilter_adding_thumb1" width="300" height="129" class="alignnone size-medium wp-image-882" /></a>
<figure>
<br><br>
When we query for an element, the same hashes are evaluated : 
<figure> 
<a href="https://januverma.files.wordpress.com/2015/06/bloomfilter_querying_thumb1.jpg"><img src="https://januverma.files.wordpress.com/2015/06/bloomfilter_querying_thumb1.jpg?w=300" alt="bloomfilter_querying_thumb1" width="300" height="196" class="alignnone size-medium wp-image-881" /></a>
<figure>
<br><br>
<strong>Optimizing a bloom filter:</strong>
<br>
There is a tradeoff between the size of the bitarray and the false positive rate. 
Note that after inserting \( n \) entries into a bloom filter of size \( m \) with \( k \) hash functions, the probability that a particular bit is still 0 is given by -
<br>
$$ P_0 = (1 - \frac{1}{m})^{kn} \simeq 1 - e^{-\frac{kn}{m}} $$
<br>
Hence the probability of a false positive i.e. the probability that all k-bits have been previously set is - 
<br>
$$ P_{err} = (1 - P_0)^{k} \simeq (1 - e^{-\frac{kn}{m}})^{k} $$
<br>
Given \( n \) and \( m \), the optimal number of hash functions that minimizes the false positive rate is -
<br>
$$ k_{optimal} \simeq \frac{m}{n} \ln 2 $$
<br>
In practice, only a small number of hash functions are used to reduce the computational overhead each additional hash function. 
<br><br>
Usually we have a fair idea of how many elements will be added to the bloom filter, in such a case, we have choose the size of the bitarray keeping the number of hash functions reasonable. 
<br><br>
e.g choosing \( m = 8n \) i.e. 1 byte per entry, and \( k=5 \), gives a false positive rate of \( 2.16\% \)
<br><br>
<strong>Implementation:</strong>
<br>
Let&#39;s try to implement a bloom filter in python following the above construction procedure. We will use python libraries <em>bitarray</em> and <em>hashlib</em>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">bitarray</span> <span class="kn">import</span> <span class="n">bitarray</span></code></pre></div>

<p>We will write a class called <em>BloomFilter</em>. This takes two arguments - size of the bitarray \( m \) and number of hashes \( k \). </p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">BloomFilter</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Implements a bloom filter.</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span> <span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfArray</span> <span class="o">=</span> <span class="n">bitarray</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span></code></pre></div>

<p><br>
As we discussed above a bloom filter computes \( k \) hashes for each element. Let&#39;s create these hash functions using python library <em>hashlib</em> which comes with base package. </p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">hash_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Build k hash functions.</span>
<span class="sd">   Map key to an integer in [0,m).</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;md5&#39;</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">y</span></code></pre></div>

<p><br>
Now we are ready to add elements to the bloom filter. </p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Add an element.</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_functions</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">None</span></code></pre></div>

<p><br>
The following method will check for membership.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Checks if an element is present in the bloom filter.</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bfArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_functions</span><span class="p">(</span><span class="n">element</span><span class="p">))</span></code></pre></div>

<p><br>
This completes our implementation of a bloom filter. Surely one can add more methods e.g. to get the number of elements added into the bloom filter or to compute the false positive rate. I&#39;ll leave that to the reader. </p>

<p><br><br>
<strong>Additional resources: </strong></p>

<ul>
<li><a href="http://billmill.org/bloomfilter-tutorial/">Bloom filter examples</a></li>
<li><a href="http://www.michaelnielsen.org/ddi/why-bloom-filters-work-the-way-they-do/">Why bloom filters work</a></li>
<li><a href="http://gsd.di.uminho.pt/members/cbm/ps/dbloom.pdf">Scalable bloom filters</a></li>
<li><a href="https://github.com/jaybaird/python-bloomfilter">python-bloomfilter</a></li>
</ul>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://jverma.github.io//bloom-filter/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://jverma.github.io//bloom-filter/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://jverma.github.io//bloom-filter/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Bloom Filters</strong> was published on <time datetime="2015-11-05T00:00:00-05:00">November 05, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://jverma.github.io//posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://jverma.github.io//community-in-graphs/" title="Community Detection in networks">Community Detection in networks</a></li>
    
      <li><a href="http://jverma.github.io//qft/" title="What do physicists mean by field theory">What do physicists mean by field theory</a></li>
    
      <li><a href="http://jverma.github.io//gatk/" title="How GATK Haplotypecaller works">How GATK Haplotypecaller works</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Janu Verma. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://jverma.github.io//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://jverma.github.io//assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-71200371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'JVerma'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





</body>
</html>
