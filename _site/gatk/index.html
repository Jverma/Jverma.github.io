<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>How GATK Haplotypecaller works &#8211; Random Inferences</title>
<meta name="description" content="Bayesian method for SNP calling.">
<meta name="keywords" content="computational biology, genomics, bioinformatics, mathematics, statistics">



<!-- Twitter Cards -->
<meta name="twitter:title" content="How GATK Haplotypecaller works">
<meta name="twitter:description" content="Bayesian method for SNP calling.">
<meta name="twitter:site" content="@januverma">
<meta name="twitter:creator" content="@januverma">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://jverma.github.io//images/sample-image-4.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="How GATK Haplotypecaller works">
<meta property="og:description" content="Bayesian method for SNP calling.">
<meta property="og:url" content="http://jverma.github.io//gatk/">
<meta property="og:site_name" content="Random Inferences">

<meta property="og:image" content="http://jverma.github.io//images/sample-image-4.jpg">






<link rel="canonical" href="http://jverma.github.io//gatk/">
<link href="http://jverma.github.io//feed.xml" type="application/atom+xml" rel="alternate" title="Random Inferences Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://jverma.github.io//assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://jverma.github.io//assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://jverma.github.io//assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://jverma.github.io//assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://jverma.github.io//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://jverma.github.io//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://jverma.github.io//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://jverma.github.io//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://jverma.github.io//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jverma.github.io//images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://jverma.github.io//">Random Inferences</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="http://jverma.github.io//about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//posts/" >Blog</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//research/" >Research</a></li>
				
				    
				        
				    
				    <li><a href="http://jverma.github.io//Code/" >Code</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


  <div class="image-wrap">
  <img src=
    
      "http://jverma.github.io//images/sample-image-4.jpg"
    
  alt="How GATK Haplotypecaller works feature image">
  
    <span class="image-credit">Photo Credit: <a href="http://wegraphics.net/downloads/free-ultimate-blurred-background-pack/">WeGraphics</a></span>
  
  </div><!-- /.image-wrap -->


<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="http://jverma.github.io//images/IMG_20141123_115642.jpg" class="bio-photo" alt="Janu Verma bio photo">


  <h3 itemprop="name">Janu Verma</h3>
  <p>Research Engineer at IBM T.J. Watson Research Center.</p>
  <a href="mailto:j.verma5@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/januverma" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  <a href="http://facebook.com/janu.verma" class="author-social" target="_blank"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a>
  
  <a href="http://linkedin.com/in/janu-verma-b79b8823" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  <a href="http://instagram.com/jverma" class="author-social" target="_blank"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
  <a href="http://januverma.tumblr.com" class="author-social" target="_blank"><i class="fa fa-fw fa-tumblr-square"></i> Tumblr</a>
  <a href="http://github.com/Jverma" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://jverma.github.io//gatk/" rel="bookmark" title="How GATK Haplotypecaller works">How GATK Haplotypecaller works</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p><a href="https://www.broadinstitute.org/gatk/">Genome Analysis Toolkit (GATK)</a> is one of the most popular bioinformatics softwares which provides functionality to perform variant discovery and genotyping. It has a strong emphasis on data quality assurance as well. The <a href="https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_tools_walkers_haplotypecaller_HaplotypeCaller.php">HaplotypeCaller</a> is the main variant calling algorithm in GATK. It calls SNPs and indels simultaneously using local de novo assembly and a Bayesian statistical model. The HalpotypeCaller algorithm works in following steps : 
<br><br>
<strong>Find Active Regions:</strong>
<br> 
First step in HalplotypeCaller procedure is to find the regions of high activity. These are the genomic regions which have strong evidence for variation. Each position is assigned a raw <strong>activity score</strong> which is the probability that the position contains a variant. This probability is calculated using the <strong>reference-confidence model</strong> (see Appendix). The raw profile thus obtained is then smoothened by copying the activity score over to the adjacent regions and then spreading out using a Gaussian kernel. Finally, the active regions are obtained as the ones containing positions with high-enough activity score.
Mathematically, for each position \( i \)</p>

<ul>
<li>Assign score \( P(i,variant) \) which is the probability of \( i \) being a variant.</li>
<li>For each \( j \) in the interval around \( i \) of radius \( r \leq 50bp \) 
$$ P(j,variant) = P(j,variant) + P(i,variant)$$ 
Here \( r \) is equal to the number of high quality soft-clipped bases that immediately follow or precede \( i \).</li>
<li>The profile score is spread out using Gaussian kernel upto 50bp. The score of \( i \) after spreading is denoted \( score_i \)</li>
</ul>

<p><br><br>
Then the active regions are computed as follows :</p>

<ul>
<li>Final profile score of site i is given by 
$$ FinalScore_i = \sum_{k}score_k $$
where \( k \) runs over all the positions which contribute to the score of i as in previous step.</li>
<li>Cut the genome at points where the final profile score goes from active to non-active regions by choosing a activity threshold.&lt;</li>
<li>Trimm the not-so-important bps from the regions obtained in the previous step.</li>
</ul>

<p><br><br>
<strong>Local assembly of the active regions:</strong>
<br>
In this step the active regions are re-assembled de novo by building a <a href="http://jverma.github.io//debruijn-graphs/">de Bruijn</a> type graph of the reference genome.</p>

<ul>
<li>Build a deBruijn graph \( (G) \) of the reference sequence.</li>
<li>Initialize a weight hashtable \( (W) \) with edges as keys with weight 0.</li>
<li>Build a hashtable \( (UniqNodes) \) of unique k-mers (nodes) of the graph with their positions in the graph.</li>
<li>For each read, look for its k-mers in \( UniqNodes \). If for a k-mer, there is a match and the \( kâˆ’1 \)-mer is in \( W \), increase the weight of the edge by 1. If a k-mer is not in the hashtable, we append it to the hashtable and add a new node in \( G \).</li>
<li>Prune the graph by throwing out the paths in the graph with weights below a threshold.</li>
</ul>

<p><br><br><br>
<strong>Identify Haplotypes:</strong> 
<br>
After the re-assembly graph is constructed and pruned, the halpotypes are extracted as :</p>

<ul>
<li>For each edge \( e \) in the graph, let \( i \)be the source vertex of \( e \). Compute transition probability of \( e \).
$$ Prob(e) = W[e]/OutDegree(i) $$
where \( W[e] \) is the weight of the edge and \( OutDegree(i) \) is the out degree of \( i \).</li>
<li>For each path \( p \) in the graph, compute its likelihood score as 
$$ Lik(p) = \prod_{e \in p} Prob(e) $$ 
The product is over all the edges in the path \( p \).</li>
<li>Select \( N \) paths with the highest likelihood scores. These are our potential Haplotypes.</li>
<li>Align each halpotype to the reference genome and compute a <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2723002/">CIGAR</a> string for the haplotype.</li>
</ul>

<p><br><br>
<strong>Compute haplotype likelihoods:</strong> 
<br>
In the previous step, we computed a set of potential halpotypes. This set of sites gives a super-set of what will eventually be called-variants. The next step in GATK pipeline is to compute the evidence of existence of a haplotype given the data. For each haplotype H,</p>

<ul>
<li>Align each data read against H using <strong><a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2766791/">PairHMM</a></strong> and compute the likelihood of observing the read given the halpotype. Thus we obtain \( P(read|H) \)for all reads.</li>
<li>Mariginalize the per-read likelihoods of halpotypes over alleles to get the per-read likelihoods for each allele, \( P(read|A) \) for each allele A and read. For a given site, we list all the alleles observed in the data. Then, for each read, we look at the haplotypes that support each allele; we select the haplotype that has the highest likelihood for that read, and we write that likelihood in the new table. And thatâ€™s it! For a given allele, the total likelihood will be the product of all the per-read likeli be the variants.</li>
</ul>

<p><br><br><br>
<strong>Bayesian Genotyper:</strong> 
<br>
GATK employed a Bayesian model to compute the most likely genotype of each sample at each site. The idea is to estimate the likelihoods of each possible genotype and predict the one with highest likelihood. The model is expressed by the following equation (<a href="http://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes theorem</a>) 
<br>
$$ P (G|D) = P(G)P(D|G) / \sum_i P(Gi)P(D|Gi) $$
<br>
here \( P(G) \) is the prior probability of the genotype \( G \). GATK uses a flat prior. Now the likelihood \( P(D|G) \) can be expressed as 
<br>
$$ P(D|G) = \prod_j \left( \frac{P(D_j|H_1)}{2} + \frac{P(D_j|H_2)}{2} \right) $$
<br>
where \( G = H_{1}H_{2} \) i.e. there are exactly two haplotypes (<em>diploid assumption</em>). What remains to be figured out is \( P(D_{j}|H_{k}) \), which is the per-read likelihood of the of the haplotype \( H_k \) aggregated over all the reads supporting the halpotype.This is exactly what we computed in the previous step. We assign genotype as :</p>

<ul>
<li>Compute \( P(G_{i}|D) \) for all possible genotypes \( G_i \).</li>
<li>The predicted genotype is the one with maximum likelihood i.e. 
$$ argmax_{G_{i}} [P(Gi|D)] $$ </li>
</ul>

<p><br><br><br>
<strong>Appendix - Reference Confidence Model:</strong> 
<br>
The reference confidence model computes the probability of occurrence of a variant at each position on the genome.</p>

<ul>
<li>Align the reads to the reference genome.</li>
<li>At each position, estimate the probability that some non-reference allele is segregating at that position.</li>
<li>The estimate of the probability that there is a variant at position i is given by : 
$$ P(i, variant) = \text{Number of reads with reference base}/\text{Number of reads with non-reference base} $$ </li>
</ul>

<p><br><br>
<strong>Implementation:</strong> 
<br>
A BASH script which implements the GATK variant calling pipeline using HaplotypeCaller can be found <a href="https://github.com/Jverma/GATK-pipeline">here</a>.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://jverma.github.io//gatk/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://jverma.github.io//gatk/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://jverma.github.io//gatk/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>How GATK Haplotypecaller works</strong> was published on <time datetime="2015-07-21T00:00:00-04:00">July 21, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://jverma.github.io//posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://jverma.github.io//manifold-learning/" title="Manifold learning: Introduction">Manifold learning: Introduction</a></li>
    
      <li><a href="http://jverma.github.io//bloom-filter/" title="Bloom Filters">Bloom Filters</a></li>
    
      <li><a href="http://jverma.github.io//community-in-graphs/" title="Community Detection in networks">Community Detection in networks</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Janu Verma. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>
<span>
	Subscribe to <strong><link href='Random Inferences + /feed.xml' rel='alternate' type='application/atom+xml'>RSS feed</strong>.
</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://jverma.github.io//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://jverma.github.io//assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-71200371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'JVerma'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





</body>
</html>
